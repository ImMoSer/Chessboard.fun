# 1. Принудительный редирект на HTTPS
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 2. Заголовки безопасности и поддержка SharedArrayBuffer
<IfModule mod_headers.c>
    # Включаем HSTS (Strict Transport Security) на 1 год
    # Это заставляет браузер всегда использовать HTTPS
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Заголовки для работы SharedArrayBuffer (нужны для современных движков)
    Header set Cross-Origin-Opener-Policy "same-origin"
    Header set Cross-Origin-Embedder-Policy "credentialless"
</IfModule>

# 3. Установка MIME-типа для WebAssembly
<IfModule mod_mime.c>
    AddType application/wasm .wasm
</IfModule>

# 4. Правила для SPA (Single Page Application)
# Перенаправляем всё на index.html, если файл физически не существует
<IfModule mod_rewrite.c>
    RewriteBase /
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.html [L]
</IfModule>